<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#F2F4F8" id="themeColor">
    <title>TempMail - Email Sementara</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/732/732200.png">
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- Progress Bar -->
    <div id="progressBar" class="progress-bar"></div>

    <!-- Top Bar -->
    <div class="top-bar">
        <div class="app-name">TempMail</div>
        
        <div class="top-bar-actions">
            <!-- Account Switcher -->
            <div class="account-switcher" id="accountSwitcher">
                <select id="accountSelect" onchange="switchAccount(this.value)" class="account-select">
                    <option value="">Pilih Akun</option>
                </select>
                <button onclick="showAddAccountModal()" class="icon-btn" title="Tambah Akun">
                    <i class="bi bi-plus-circle"></i>
                </button>
            </div>
            
            <!-- Dark Mode Toggle -->
            <button onclick="toggleDarkMode()" class="icon-btn" id="darkModeToggle" title="Dark Mode">
                <i class="bi bi-moon-stars"></i>
            </button>
            
            <!-- User Avatar -->
            <div class="user-avatar">
                <img src="https://cdn.odzre.my.id/cpz.jpg" alt="User">
            </div>
        </div>
    </div>

    <!-- Search Bar -->
    <div class="search-container" id="searchContainer" style="display: none;">
        <div class="search-bar">
            <i class="bi bi-search"></i>
            <input type="text" id="searchInput" placeholder="Cari pesan..." autocomplete="off">
            <button onclick="clearSearch()" class="clear-search" id="clearSearchBtn" style="display: none;">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
    </div>

    <!-- Loading Indicator Global -->
    <div id="globalLoading" class="global-loading" style="display: none;">
        <div class="loading-spinner"></div>
    </div>

    <main id="main-container">
        
        <!-- HOME SECTION -->
        <section id="view-home" class="tab-view active">
            <div class="hero-card">
                <div class="icon-glow">
                    <i class="bi bi-shield-lock-fill"></i>
                </div>
                <h2>Temp Identity</h2>
                <p>Gunakan email sementara ini untuk verifikasi agar privasi utamamu tetap aman.</p>
            </div>

            <div class="email-action-area">
                <label>Email Kamu Saat Ini</label>
                <div class="email-display">
                    <span id="emailAddress">Generating...</span>
                    <button onclick="copyEmail()" class="copy-btn" id="copyEmailBtn"><i class="bi bi-copy"></i></button>
                </div>
                <div class="status-indicator">
                    <span class="dot"></span> <span id="timerText">Auto-refresh: 10s</span>
                </div>
            </div>
            
            <!-- QUICK STATS CARD -->
            <div class="stats-card">
                <h3><i class="bi bi-pie-chart"></i> Statistik Inbox</h3>
                <div class="stats-grid">
                    <div class="stat-item" onclick="switchTab('view-inbox', document.querySelectorAll('.nav-item')[1])">
                        <div class="stat-icon" style="background: #EEF2FF; color: #4F46E5;">
                            <i class="bi bi-envelope"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="totalMessages">0</span>
                            <span class="stat-label">Total Pesan</span>
                        </div>
                    </div>
                    
                    <div class="stat-item" onclick="switchTab('view-updates', document.querySelectorAll('.nav-item')[2])">
                        <div class="stat-icon" style="background: #FEF3C7; color: #F59E0B;">
                            <i class="bi bi-bell"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="unreadMessages">0</span>
                            <span class="stat-label">Belum Dibaca</span>
                        </div>
                    </div>
                    
                    <div class="stat-item" onclick="filterStarred()">
                        <div class="stat-icon" style="background: #FEE2E2; color: #EF4444;">
                            <i class="bi bi-star-fill"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="starredMessages">0</span>
                            <span class="stat-label">Penting</span>
                        </div>
                    </div>
                    
                    <div class="stat-item" onclick="showShortcutsHelp()">
                        <div class="stat-icon" style="background: #E0F2FE; color: #0EA5E9;">
                            <i class="bi bi-keyboard"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value">?</span>
                            <span class="stat-label">Shortcuts</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RECENT ACTIVITY -->
            <div class="recent-activity">
                <h3><i class="bi bi-clock-history"></i> Aktivitas Terkini</h3>
                <div id="recentActivityList" class="activity-list">
                    <div class="activity-item loading">Memuat aktivitas...</div>
                </div>
            </div>
        </section>

        <!-- INBOX SECTION (READ MESSAGES) -->
        <section id="view-inbox" class="tab-view">
            <div class="section-header">
                <h2>Riwayat Inbox</h2>
                <div class="section-actions">
                    <button onclick="toggleSearch()" class="action-btn" title="Cari">
                        <i class="bi bi-search"></i>
                    </button>
                    <button onclick="exportInbox()" class="action-btn" title="Backup">
                        <i class="bi bi-download"></i>
                    </button>
                    <button onclick="clearInbox()" class="trash-btn" id="clearInboxBtn" title="Hapus Semua">
                        <i class="bi bi-trash3"></i>
                    </button>
                </div>
            </div>

            <!-- Filter Bar -->
            <div class="filter-bar" id="filterBar">
                <div class="filter-tabs">
                    <button class="filter-tab active" onclick="setFilter('all')" id="filterAll">
                        <i class="bi bi-list-ul"></i> Semua
                    </button>
                    <button class="filter-tab" onclick="setFilter('unread')" id="filterUnread">
                        <i class="bi bi-envelope"></i> Belum Dibaca
                    </button>
                    <button class="filter-tab" onclick="setFilter('starred')" id="filterStarred">
                        <i class="bi bi-star"></i> Penting
                    </button>
                    <button class="filter-tab" onclick="setFilter('attachments')" id="filterAttachments">
                        <i class="bi bi-paperclip"></i> Lampiran
                    </button>
                </div>
                
                <div class="filter-date">
                    <select id="dateFilterSelect" onchange="setDateFilter(this.value)">
                        <option value="">Semua Waktu</option>
                        <option value="today">Hari Ini</option>
                        <option value="yesterday">Kemarin</option>
                        <option value="week">7 Hari Terakhir</option>
                        <option value="month">30 Hari Terakhir</option>
                        <option value="custom">Kustom</option>
                    </select>
                    
                    <div class="custom-date-range" id="customDateRange" style="display: none;">
                        <input type="date" id="startDate" onchange="applyCustomDateFilter()">
                        <span>s/d</span>
                        <input type="date" id="endDate" onchange="applyCustomDateFilter()">
                    </div>
                </div>
            </div>

            <div id="readList" class="message-list virtual-scroll-container"></div>
            <div id="readListLoader" class="list-loader" style="display: none;">
                <div class="loading-spinner small"></div>
                <span>Memuat...</span>
            </div>
        </section>

        <!-- UPDATES SECTION (UNREAD MESSAGES) -->
        <section id="view-updates" class="tab-view">
            <div class="section-header">
                <h2>Update Baru <span class="badge" id="badge-count" style="display:none">0</span></h2>
                <div class="section-actions">
                    <button onclick="toggleSearch()" class="action-btn" title="Cari">
                        <i class="bi bi-search"></i>
                    </button>
                    <button onclick="markAllAsRead()" class="action-btn" title="Tandai semua dibaca">
                        <i class="bi bi-check-all"></i>
                    </button>
                </div>
            </div>

            <!-- Filter Bar (sama dengan inbox) -->
            <div class="filter-bar" id="filterBarUpdates">
                <div class="filter-tabs">
                    <button class="filter-tab active" onclick="setFilter('all')" id="filterAllUpdates">
                        <i class="bi bi-list-ul"></i> Semua
                    </button>
                    <button class="filter-tab" onclick="setFilter('starred')" id="filterStarredUpdates">
                        <i class="bi bi-star"></i> Penting
                    </button>
                    <button class="filter-tab" onclick="setFilter('attachments')" id="filterAttachmentsUpdates">
                        <i class="bi bi-paperclip"></i> Lampiran
                    </button>
                </div>
            </div>

            <div id="unreadList" class="message-list virtual-scroll-container"></div>
            <div id="unreadListLoader" class="list-loader" style="display: none;"></div>
        </section>

        <!-- DOCS SECTION -->
        <section id="view-docs" class="tab-view">
            <div class="section-header">
                <h2>Dokumentasi</h2>
                <button onclick="importInbox()" class="action-btn" title="Restore Backup">
                    <i class="bi bi-upload"></i>
                </button>
            </div>
            
            <div class="doc-card" style="border: 2px dashed #E5E7EB; background: transparent; text-align: center;">
                <h3 style="justify-content: center; font-size: 1rem;">Dokumentasi Sistem</h3>
                <p style="margin-bottom: 15px; font-size: 0.85rem;">Baca detail teknis, keamanan, dan arsitektur sistem.</p>
                <a href="docs.html" class="btn-whatsapp" style="background: var(--primary); box-shadow: 0 4px 15px rgba(0,0,0,0.2); width: 100%; justify-content: center; color: white;">
                    <i class="bi bi-book-half"></i> Buka Dokumentasi Penuh
                </a>
            </div>

            <div class="doc-card">
                <h3><i class="bi bi-code-slash"></i> Cara Penggunaan</h3>
                <ul>
                    <li><strong>Ctrl/Cmd + N</strong> - Buat email baru</li>
                    <li><strong>Ctrl/Cmd + F</strong> - Cari pesan</li>
                    <li><strong>Ctrl/Cmd + D</strong> - Dark mode</li>
                    <li><strong>Ctrl/Cmd + A</strong> - Tandai semua dibaca</li>
                    <li><strong>Alt + 1-4</strong> - Ganti tab</li>
                    <li><strong>Esc</strong> - Tutup modal</li>
                    <li><strong>?</strong> - Bantuan shortcuts</li>
                </ul>
            </div>

            <div class="doc-card">
                <h3><i class="bi bi-database"></i> Data & Privasi</h3>
                <ul>
                    <li>Semua data disimpan secara lokal di browser Anda</li>
                    <li>Backup data bisa diexport kapan saja</li>
                    <li>Email akan otomatis terhapus setelah 7 hari</li>
                    <li>Tidak ada data yang dikirim ke server kecuali email</li>
                </ul>
            </div>

            <div class="doc-card developer-card">
                <h3>Developer Info</h3>
                <p class="dev-name">JHON FORUM</p>
                <p>Aplikasi ini dibuat untuk melindungi privasi user dari spam.</p>
                <a href="https://whatsapp.com/channel/0029VaLiUSS5q08hPj5mcH0m" target="_blank" class="btn-whatsapp">
                    <i class="bi bi-whatsapp"></i> Join Saluran Developer
                </a>
            </div>
        </section>

    </main>

    <!-- BOTTOM NAVIGATION -->
    <nav class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('view-home', this)">
            <i class="bi bi-house-door"></i>
            <span>Home</span>
        </div>
        
        <div class="nav-item" onclick="switchTab('view-inbox', this)">
            <i class="bi bi-archive"></i>
            <span>Inbox</span>
        </div>

        <div class="nav-fab-wrapper">
            <div class="nav-fab" onclick="confirmNewEmail()" id="newEmailFab">
                <i class="bi bi-plus-lg"></i>
            </div>
        </div>

        <div class="nav-item" onclick="switchTab('view-updates', this)">
            <div class="icon-wrapper">
                <i class="bi bi-bell"></i>
                <div class="nav-dot" id="nav-dot" style="display: none;"></div>
            </div>
            <span>Updates</span>
        </div>

        <div class="nav-item" onclick="switchTab('view-docs', this)">
            <i class="bi bi-grid"></i>
            <span>Docs</span>
        </div>
    </nav>

    <!-- MODAL DETAIL PESAN -->
    <div id="msgModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalSubject">Subject</h3>
                <div class="modal-actions">
                    <button onclick="toggleStarCurrentMessage()" class="modal-btn" id="starCurrentBtn" title="Tandai penting">
                        <i class="bi bi-star"></i>
                    </button>
                    <button onclick="openShareModal()" class="modal-btn share-btn" id="shareBtnInModal" title="Bagikan">
                        <i class="bi bi-share"></i>
                    </button>
                    <button onclick="closeModal('msgModal')" class="modal-btn close-btn" title="Tutup">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>
            </div>
            <div class="modal-meta" id="modalMeta"></div>
            <div class="modal-attachments" id="modalAttachments" style="display: none;"></div>
            <div class="modal-body" id="modalBody">...</div>
        </div>
    </div>

    <!-- MODAL SHARE PESAN -->
    <div id="shareMsgModal" class="modal share-modal">
        <div class="modal-content share-content">
            <div class="modal-header">
                <h3>Bagikan Pesan</h3>
                <button onclick="closeModal('shareMsgModal')" class="modal-btn close-btn" title="Tutup">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            
            <p class="share-description">
                Pilih cara membagikan pesan ini
            </p>

            <div class="share-options">
                <button onclick="shareAsImage()" class="share-option" id="shareImageBtn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <i class="bi bi-image"></i>
                    <div class="share-option-text">
                        <strong>Share Gambar</strong>
                        <span>Instagram, Facebook, dll</span>
                    </div>
                </button>
                
                <button onclick="shareToWaText()" class="share-option" style="background: #25D366;">
                    <i class="bi bi-whatsapp"></i>
                    <div class="share-option-text">
                        <strong>Share Teks WA</strong>
                        <span>Kirim ke WhatsApp</span>
                    </div>
                </button>

                <button onclick="copyMessageText()" class="share-option" style="background: var(--primary);">
                    <i class="bi bi-clipboard"></i>
                    <div class="share-option-text">
                        <strong>Copy Teks</strong>
                        <span>Salin ke clipboard</span>
                    </div>
                </button>
            </div>

            <button onclick="closeModal('shareMsgModal')" class="cancel-btn">
                Batal
            </button>
        </div>
    </div>

    <!-- MODAL TAMBAH AKUN -->
    <div id="addAccountModal" class="modal confirm-modal">
        <div class="modal-content confirm-content">
            <div class="confirm-icon">
                <i class="bi bi-envelope-plus"></i>
            </div>
            <h3>Tambah Akun Baru</h3>
            <input type="email" id="newAccountEmail" class="modal-input" placeholder="Masukkan email" autocomplete="off">
            <div class="confirm-buttons" style="margin-top: 20px;">
                <button onclick="closeModal('addAccountModal')" class="confirm-btn cancel">Batal</button>
                <button onclick="addNewAccount()" class="confirm-btn ok">Tambah</button>
            </div>
        </div>
    </div>

    <!-- MODAL BACKUP/RESTORE -->
    <div id="backupModal" class="modal confirm-modal">
        <div class="modal-content confirm-content">
            <div class="confirm-icon">
                <i class="bi bi-database"></i>
            </div>
            <h3 id="backupModalTitle">Backup & Restore</h3>
            <p id="backupModalMessage">Pilih file backup untuk direstore</p>
            <input type="file" id="backupFile" accept=".json" style="display: none;">
            <div class="confirm-buttons" style="margin-top: 20px;">
                <button onclick="closeModal('backupModal')" class="confirm-btn cancel">Batal</button>
                <button onclick="selectBackupFile()" class="confirm-btn ok">Pilih File</button>
            </div>
        </div>
    </div>

    <!-- MODAL MARK ALL READ -->
    <div id="markAllReadModal" class="modal confirm-modal">
        <div class="modal-content confirm-content">
            <div class="confirm-icon">
                <i class="bi bi-check-all" style="color: var(--success);"></i>
            </div>
            <h3>Tandai Semua Dibaca</h3>
            <p id="markAllReadMessage">Ada <span id="unreadCountForMark">0</span> pesan belum dibaca. Tandai semua sebagai sudah dibaca?</p>
            <div class="confirm-buttons">
                <button onclick="closeModal('markAllReadModal')" class="confirm-btn cancel">Batal</button>
                <button onclick="confirmMarkAllRead()" class="confirm-btn ok" style="background: var(--success);">Ya, Tandai</button>
            </div>
        </div>
    </div>

    <!-- MODAL SHORTCUTS HELP -->
    <div id="shortcutsHelpModal" class="modal shortcuts-modal">
        <div class="modal-content shortcuts-content">
            <div class="modal-header">
                <h3><i class="bi bi-keyboard"></i> Keyboard Shortcuts</h3>
                <button onclick="closeModal('shortcutsHelpModal')" class="modal-btn close-btn">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            
            <div class="shortcuts-grid">
                <div class="shortcut-category">
                    <h4>Navigasi</h4>
                    <div class="shortcut-item">
                        <kbd>Alt</kbd> + <kbd>1</kbd> <span>Home</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Alt</kbd> + <kbd>2</kbd> <span>Inbox</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Alt</kbd> + <kbd>3</kbd> <span>Updates</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Alt</kbd> + <kbd>4</kbd> <span>Docs</span>
                    </div>
                </div>
                
                <div class="shortcut-category">
                    <h4>Aksi</h4>
                    <div class="shortcut-item">
                        <kbd>Ctrl/Cmd</kbd> + <kbd>N</kbd> <span>Email baru</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Ctrl/Cmd</kbd> + <kbd>F</kbd> <span>Cari</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Ctrl/Cmd</kbd> + <kbd>D</kbd> <span>Dark mode</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>Ctrl/Cmd</kbd> + <kbd>A</kbd> <span>Tandai semua dibaca</span>
                    </div>
                </div>
                
                <div class="shortcut-category">
                    <h4>Lainnya</h4>
                    <div class="shortcut-item">
                        <kbd>Esc</kbd> <span>Tutup modal</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>S</kbd> <span>Star/unstar pesan</span>
                    </div>
                    <div class="shortcut-item">
                        <kbd>?</kbd> <span>Bantuan ini</span>
                    </div>
                </div>
            </div>
            
            <div class="shortcuts-footer">
                <button onclick="closeModal('shortcutsHelpModal')" class="btn-primary">Tutup</button>
            </div>
        </div>
    </div>

    <!-- MODAL CLEAR INBOX CONFIRMATION -->
    <div id="clearInboxModal" class="modal confirm-modal">
        <div class="modal-content confirm-content">
            <div class="confirm-icon">
                <i class="bi bi-exclamation-triangle" style="color: var(--danger);"></i>
            </div>
            <h3>Hapus Semua Pesan</h3>
            <p>Semua pesan di inbox akan dihapus permanen. Tindakan ini tidak dapat dibatalkan.</p>
            <div class="confirm-buttons">
                <button onclick="closeModal('clearInboxModal')" class="confirm-btn cancel">Batal</button>
                <button onclick="confirmClearInbox()" class="confirm-btn ok" style="background: var(--danger);">Hapus</button>
            </div>
        </div>
    </div>

    <!-- CAPTURE CONTAINER UNTUK GENERATE GAMBAR (HIDDEN) -->
    <div id="capture-container" style="position: fixed; left: -9999px; top: 0;">
        <div id="capture-card" class="capture-card">
            <div class="capture-header">
                <div class="capture-logo">
                    <i class="bi bi-shield-lock-fill"></i> TempMail
                </div>
                <div class="capture-badge">Pesan Sementara</div>
            </div>
            
            <div class="capture-body">
                <div class="capture-field">
                    <div class="capture-label">DARI:</div>
                    <div class="capture-value" id="capEmail">example@mail.com</div>
                </div>
                
                <div class="capture-field">
                    <div class="capture-label">SUBJEK:</div>
                    <div class="capture-value capture-subject" id="capSubject">Subjek Pesan</div>
                </div>
                
                <div class="capture-field">
                    <div class="capture-label">PESAN:</div>
                    <div class="capture-value capture-message" id="capMsg">
                        Isi pesan akan muncul disini...
                    </div>
                </div>
            </div>

            <div class="capture-footer">
                <div>Temporary Email | JHON FORUM</div>
                <div class="capture-time">Â© 2024 TempMail - Privasi Terjaga</div>
            </div>
        </div>
    </div>

    <!-- TOAST NOTIFICATION -->
    <div id="toast" class="toast"></div>

    <!-- Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="script.js"></script>
</body>
</html>